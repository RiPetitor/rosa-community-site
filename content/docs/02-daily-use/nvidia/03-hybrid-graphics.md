+++
title = "Гибридная графика (Optimus)"
description = "Настройка ноутбуков с гибридной графикой (AMD/Intel + NVIDIA)"
weight = 3
+++

{{ doc_dates() }}

Многие ноутбуки оснащены двумя видеокартами: встроенной от Intel или AMD для экономии энергии и дискретной от NVIDIA для высокой производительности. Эта технология называется NVIDIA Optimus. В ROSA Linux для её настройки используется утилита `envycontrol`.

## 1. Установка драйвера и envycontrol

Процесс включает установку драйвера NVIDIA и последующую настройку.

1.  **Установите драйвер.** Самый простой способ — использовать `kroko-cli`.
    ```bash
    sudo kroko-cli autoinstall
    ```

2.  **Настройте GRUB.** Откройте файл `/etc/default/grub` в текстовом редакторе с правами `root` (например, `sudo nano /etc/default/grub`). В конец строки `GRUB_CMDLINE_LINUX_DEFAULT` добавьте параметр `nvidia-drm.modeset=1`.

    *Пример:*
    `GRUB_CMDLINE_LINUX_DEFAULT="quiet splash resume=UUID=... nvidia-drm.modeset=1"`

3.  **Обновите конфигурацию GRUB.**
    ```bash
    sudo update-grub2
    ```
    
4.  **Установите envycontrol.**
    ```bash
    sudo dnf in envycontrol
    ```

5.  **Перезагрузите систему.**
    ```bash
    sudo reboot
    ```

## 2. Переключение режимов

После перезагрузки вы можете переключать графические режимы.

### Через терминал

-   **Только встроенная графика (Intel/AMD):**
    ```bash
    sudo envycontrol -s integrated
    ```
-   **Гибридный режим (Optimus):** Карта NVIDIA включается только для определённых приложений.
    ```bash
    sudo envycontrol -s hybrid
    ```
-   **Только NVIDIA (макс. производительность):**
    ```bash
    sudo envycontrol -s nvidia
    ```
После смены режима требуется перезагрузка.

### Графический интерфейс

Для удобного переключения без терминала существуют виджеты и расширения:
-   **KDE:** Установите виджет `Optimus GPU Switcher KDE`.
-   **GNOME:** Установите расширение `GPU profile selector`.

## Устаревшие видеокарты (серии 8/9/200)

Если в репозиториях ROSA нет драйверов для очень старых карт, можно использовать специальный скрипт, который скачивает и патчит официальный драйвер с сайта NVIDIA.

Процесс в общих чертах:
1.  Добавьте открытый драйвер `nouveau` в чёрный список, чтобы он не загружался.
2.  Установите все зависимости для сборки (`kernel-devel`, `make` и т.д.).
3.  Скачайте и запустите скрипт для патча.
4.  Запустите полученный `.run` файл для установки.

<div class="info">
  <div class="title">Примечание</div>
  Для точной настройки работы видеокарты или в случае сложностей рекомендуется обратиться за помощью к опытным пользователям на <a href="https://forum.rosa.ru">Форум</a>
</div>

## Следующий шаг

- [Диагностика и устранение неисправностей](@/docs/02-daily-use/nvidia/04-troubleshooting.md)
