+++
title = "Проблемы после обновлений"
description = "Исправление неполадок, возникших после обновления системы"
weight = 2
+++

{{ doc_dates() }}

Обновления — важная часть безопасности и функциональности системы, но иногда они приводят к неожиданным проблемам. Вот как их решить.

## Откат обновления

Если проблема возникла сразу после `dnf update`, самое простое решение — откатить транзакцию.

### Использование истории DNF
```bash
# 1. Посмотреть историю транзакций
sudo dnf history

# 2. Найти номер (ID) последнего обновления и посмотреть детали
sudo dnf history info N

# 3. Откатить транзакцию (замените N на ID)
sudo dnf history undo N
```

<div class="warning">
  <div class="title">Осторожно</div>
  Откат транзакции может затронуть множество пакетов и потребовать отката других, зависимых от неё транзакций. DNF предупредит об этом.
</div>

## Проблемы с драйвером NVIDIA

После обновления ядра проприетарный драйвер NVIDIA может перестать работать.

### Решение 1: Утилита kroko-cli (Рекомендуемый способ)
В ROSA Linux есть утилита для автоматического управления драйверами NVIDIA.
```bash
sudo kroko-cli autoinstall
```
Эта команда должна определить проблему и переустановить/пересобрать всё необходимое.

### Решение 2: Ручная пересборка модуля
Если вы устанавливали драйверы вручную или хотите больше контроля:
1.  Убедитесь, что установлены заголовочные файлы для **нового** ядра: `sudo dnf install kernel-devel`
2.  Запустите пересборку модуля. Команда зависит от способа установки драйвера:
    ```bash
    # Если драйвер ставился через RPM-пакеты (akmod-nvidia)
    sudo akmods --force

    # Если драйвер ставился вручную (через .run файл)
    sudo dkms autoinstall
    ```
3.  Принудительно обновите образ initramfs и перезагрузитесь:
    ```bash
    sudo dracut --force
    sudo reboot
    ```

## Сломанные зависимости

Иногда обновление прерывается, оставляя систему в нестабильном состоянии.

### Диагностика
```bash
sudo dnf check
```

### Восстановление
```bash
# Попытка синхронизировать пакеты с репозиторием
sudo dnf distro-sync
```
<div class="danger">
  <div class="title">Опасно</div>
  Команда `distro-sync` может откатить (понизить) некоторые пакеты до версий в репозитории. Используйте с осторожностью, если у вас подключены сторонние репозитории.
</div>

```bash
# Принудительная переустановка конкретного пакета
sudo dnf reinstall имя-пакета

# Удаление проблемного пакета (если он не критичен)
sudo dnf remove имя-пакета
```

## Восстановление из снимка системы
Если вы используете утилиту для снимков системы (например, **Timeshift**), лучший способ всё исправить — это откатиться к состоянию до обновления.
```bash
# Пример для Timeshift
sudo timeshift --restore
```
Это самый надёжный способ, который отменяет абсолютно все изменения.

## Проверка целостности пакетов
Эта команда проверяет все установленные пакеты и ищет изменённые файлы.
```bash
# Проверка всех пакетов
sudo rpm -Va
```
Следующая команда попытается автоматически переустановить все пакеты, у которых проверка выявила несоответствие контрольной суммы (признак повреждения).
```bash
sudo dnf reinstall $(rpm -Va 2>&1 | grep -E '^..5' | awk '{print $NF}' | xargs rpm -qf | sort -u)
```

## Очистка кэша DNF
В редких случаях проблема может быть в повреждённом кэше пакетов.
```bash
sudo dnf clean all
sudo dnf makecache
```

## Следующий шаг
- [Нет сети / звука / видео](@/docs/04-troubleshooting/03-hardware-issues.md)
