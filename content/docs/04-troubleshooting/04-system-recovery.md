+++
title = "Восстановление системы"
description = "Методы восстановления серьёзно повреждённой системы"
weight = 4
+++

{{ doc_dates() }}

Если система серьёзно повреждена (например, не загружается даже после попыток исправить загрузчик), есть несколько способов её восстановить, не прибегая к полной переустановке.

## Способ 1: Откат с помощью снимков системы

Это самый простой и надёжный способ, если вы заранее позаботились о настройке. Утилиты, такие как **Timeshift** или **Snapper**, создают "снимки" состояния системы, к которым можно мгновенно откатиться.

### Timeshift
Timeshift прост в настройке и использовании.
```bash
# Установка (если ещё не установлен)
sudo dnf install timeshift

# Просмотр списка доступных снимков
sudo timeshift --list

# Восстановление (выберите нужный снимок из списка)
sudo timeshift --restore
```
<div class="warning">
  <div class="title">Данные пользователя</div>
  По умолчанию Timeshift **не сохраняет** ваши личные файлы в домашнем каталоге. Он предназначен для восстановления системы, а не данных. Используйте отдельные инструменты для бэкапа личных файлов.
</div>

### Snapper (для Btrfs)
Если вы используете файловую систему Btrfs, `snapper` — более мощная альтернатива. Он может автоматически создавать снимки до и после установки пакетов, а в связке с `grub-btrfs` позволяет загружаться прямо в снимок из меню GRUB.

## Способ 2: Восстановление с помощью `chroot`

Если снимков нет, можно "войти" в сломанную систему с помощью Live USB и попытаться исправить её изнутри. Этот процесс называется `chroot`.

**Подробное руководство по `chroot`** находится в статье **[Система не загружается](@/docs/04-troubleshooting/01-boot-issues.md)**.

После того как вы выполнили `chroot`, вы можете:
- **Переустановить ключевые пакеты:**
  ```bash
  # Пример переустановки всей базовой группы пакетов
  sudo dnf reinstall '@core'
  ```
- **Изменить неверные конфигурационные файлы.**
- **Сбросить забытый пароль:**
  ```bash
  passwd имя_пользователя
  ```
- **Обновить конфигурацию загрузчика (`grub2-mkconfig`).**

## Способ 3: Сброс пароля root через GRUB

Если вы просто забыли пароль, можно сбросить его без Live USB.

1.  В меню GRUB нажмите `e` для редактирования.
2.  Найдите строку, начинающуюся с `linux`.
3.  Добавьте в конец этой строки: `init=/bin/bash`.
4.  Нажмите `Ctrl + X` для загрузки в однопользовательский режим.
5.  В появившейся командной строке выполните:
    ```bash
    # Перемонтируйте корневую ФС в режим чтения/записи
    mount -o remount,rw /

    # Установите новый пароль
    passwd

    # Перезагрузите систему
    exec /sbin/init
    ```

## Способ 4: Проверка и исправление файловой системы

Повреждение файловой системы — частая причина сбоев. Проверку **нельзя** запускать на примонтированном разделе.

1.  Загрузитесь с Live USB.
2.  Найдите нужный раздел с помощью `lsblk`.
3.  Запустите проверку (замените `sdaX` на ваш раздел):
    ```bash
    # Для ext4
    sudo fsck.ext4 -f /dev/sdaX

    # Для btrfs (базовая проверка)
    sudo btrfs check /dev/sdaX
    ```

## Крайний случай: Переустановка с сохранением `/home`

Если ничего не помогает, можно переустановить систему, сохранив при этом личные данные.

1.  Загрузитесь с Live USB.
2.  **Сделайте резервную копию** вашего домашнего каталога (`/home/user`) на внешний носитель.
3.  Запустите установщик ROSA.
4.  На этапе разметки диска выберите «Ручная разметка».
5.  Укажите ваш корневой раздел (`/`) и **отметьте его для форматирования**.
6.  Укажите ваш домашний раздел (`/home`) и **НЕ отмечайте его для форматирования**.
7.  Продолжите установку.

После установки ваши личные файлы и настройки программ останутся на месте.

## Следующий шаг
- [Где смотреть логи](@/docs/04-troubleshooting/05-logs.md)
